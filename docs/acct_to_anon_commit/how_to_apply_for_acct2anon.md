Client ↔ Node Protocol  AcctToAnon  (how_to_apply_for_acct_to_anon_commit_v1)

Scope
- Wire format for applying a public-account-to-anonymous-commitment operation.
- Amount is public. No signature. Uses ZK proof.
- Block tx format is specified in acct_to_anon_in_blocks_v1.

0. JSON value types
- Hex32 and HexField and ZKProofHex are JSON strings.
- version and amount are JSON integers.

Canonical encodings
- Hex32  
  string hex for 32 bytes, 64 chars, lowercase, no "0x".
- HexField  
  string hex, lowercase, even length, no "0x".
- ZKProofHex  
  HexField of zk proof bytes from get_zkproof_for_acct_to_anon_tx.

1. Request envelope
{
  "application_type": string,
  "payload":          dict
}

2. AcctToAnon request

Request envelope
{
  "application_type": "AcctToAnon",
  "payload": {
    "version":     1,
    "from_addr":   Hex32,
    "amount":      int,
    "anon_commit": Hex32,
    "zk_proof":    ZKProofHex
  }
}

How Client fills payload (API pointers only)
- version  
  constant 1
- from_addr  
  sender on-chain address
- amount  
  positive integer in the FieldIntNonNeg range  
  (1 ≤ amount ≤ 2^96 − 1, matching node-side checks)
- anon_commit  
  computed by calling
    get_poseidon_hash(val_bytes, sk_bytes, nonce_bytes, addr_bytes)
  where val_bytes encodes amount and addr_bytes encodes from_addr
- zk_proof  
  generated by calling
    get_zkproof_for_acct_to_anon_tx(
      sk_bytes,
      val_bytes,
      nonce_bytes,
      addr_bytes,
      anon_commit_bytes
    )
  then hex-encoding the returned proof bytes

3. Node response

Success
{
  "ok": true,
  "new_block": {
    "account_root": Hex32,
    "tx_root":      Hex32,
    "commit_root":  Hex32,
    "applied_addr": Hex32,
    "from_addr":    Hex32,
    "amount":       int,
    "anon_commit":  Hex32,
    "tx": {
      "tx_type": "AcctToAnon",
      "payload": dict
    }
  }
}

Failure
{
  "ok":  false,
  "err": string
}

Client handling rule
- If ok is false: log err and treat the request as not accepted.
- If ok is true: pass new_block to blockchain core for chain update.

End
